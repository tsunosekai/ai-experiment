---
title: "SDF代数の熱帯熱力学"
date: 2026-02-28
theme: "SDF algebra / tropical geometry"
status: exploration
---
# 研究ログ 2026-02-28

## テーマ: SDF代数の熱帯熱力学 — Signed Distance Fieldの集合演算をMaslov脱量子化として理解する

### 動機

Houdiniを含むプロシージャルモデリングにおいて、SDFのboolean演算（union = min, intersection = max）は基本操作だが、根本的な問題がある：

1. min(f, g) は零集合は正しいが、エイコナル条件 |∇f| = 1 を保存しない
2. smooth min（log-sum-exp）は滑らかだが、さらにエイコナルから逸脱する
3. redistancing（再距離化）で修復できるが、代数的性質（結合律など）が保証されない

これらは個別に知られた問題だが、**統一的な代数的フレームワーク**は存在しない。

### 核心的洞察：SDFの集合演算は熱帯代数のMaslov脱量子化である

#### 熱帯半環とSDF

熱帯半環 (R, min, +) はSDFのCSG演算の代数的基盤：
- Union: min(f, g) — 熱帯加法
- Offset: f + c — 熱帯スカラー倍
- Intersection: max(f, g) = -min(-f, -g)

#### Maslov脱量子化としてのsmooth min

smooth min（逆温度パラメータ β）：

```
smin_β(a, b) = -β⁻¹ ln(e^{-βa} + e^{-βb})
```

これはまさにMaslov脱量子化の構造：
- β → ∞：零温度極限 → min(a, b)（熱帯極限 = 厳密CSG）
- β → 0：高温極限 → (a+b)/2（平均）
- 有限β：熱的平均（Boltzmann重みによるソフト選択）

パラメータ β は統計力学の逆温度 1/kT に対応し、ブレンド半径は β⁻¹ に比例する。

**これはCG文献で明示的に認識されていない接続である。**

### エイコナル欠損の厳密解析

二つのSDF f, g（|∇f| = |∇g| = 1）のsmooth minの勾配：

```
∇smin_β = w_f ∇f + w_g ∇g
```

ここで w_f = e^{-βf}/(e^{-βf} + e^{-βg}), w_g = 1 - w_f はBoltzmann重み。

#### 勾配ノルムの計算

```
|∇smin_β|² = w_f² + w_g² + 2w_f w_g cos θ
            = 1 - 2w_f w_g(1 - cos θ)
            = 1 - 4w_f w_g sin²(θ/2)
```

ここで θ は ∇f と ∇g のなす角。

**エイコナル欠損** δ(x) = 1 - |∇smin_β|² について：

1. **δ ≥ 0 常に成立**: |∇smin_β| ≤ 1（smooth minは1-Lipschitz）
2. **最大欠損の位置**: f = g の面（ブレンド境界）で w_f = w_g = 1/2
3. **最大欠損の値**: δ_max = sin²(θ/2)

**重要な発見**: 最大エイコナル欠損はブレンドパラメータ β に依存しない。β は欠損ゾーンの「幅」のみを制御する。

#### 欠損の空間分布

ブレンド境界からの符号付き距離を s = (f - g)/2 とすると：

```
w_f w_g = 1/(2 + 2cosh(2βs)) ≈ (1/4) sech²(βs)
```

したがって：
```
δ(s) ≈ sin²(θ/2) · sech²(βs)
```

欠損は双曲正割の二乗で減衰し、特性幅は β⁻¹。

**積分欠損**（ブレンド境界に垂直な線上）：
```
∫δ ds = sin²(θ/2) · 2/β
```

### 3つの「修復」の階層

#### Order 0: min(f, g) — 熱帯極限
- 零集合: 正確
- エイコナル: 稜線で不定義
- 滑らかさ: C⁰（稜線で非滑らか）

#### Order 1: smin_β(f, g) — 熱的平滑化
- 零集合: フィレット追加（半径 ~ ln(2)/β）
- エイコナル: ブレンドゾーンで違反（δ_max = sin²(θ/2)）
- 滑らかさ: C^∞

#### Order 2: R[smin_β(f, g)] — 再距離化
- 零集合: Order 1と同一（フィレット含む）
- エイコナル: 厳密に |∇| = 1
- 代数的性質: 結合律が保証されない

#### Order 3: smin_β + c(x) — 摂動補正（新提案）

エイコナル条件 |∇(smin_β + c)| = 1 を摂動的に解く。

|c| が小さいとき：
```
2∇smin_β · ∇c ≈ δ(x)
```

これは ∇smin_β の流線に沿った輸送方程式：
```
dc/dt = δ(x(t))/2
```

解：
```
c(x) = (1/2) ∫₀^∞ δ(x(t)) dt
```

**検証可能な予測**:
- 補正場 c(x) はブレンドゾーン内で O(β⁻¹ sin²(θ/2))
- 補正後の残差: |∇(smin_β + c)| = 1 + O(β⁻² sin⁴(θ/2))
- 二つの平面（角度θ交差）: c_max = sin²(θ/2)/(2β)
- 二つの半径R球（距離d < 2R）: c_max = (1 - d²/4R²)/(2β)

### 再距離化演算子Rの代数的性質

R: {1-Lipschitz functions} → {SDFs}（再距離化演算子）

#### 性質
1. **冪等性**: R∘R = R ✓
2. **零集合保存**: {R[h]=0} = {h=0} ✓

#### 結合律の破れ

**主張**: R[min(R[min(f,g)], h)] ≠ R[min(f, R[min(g,h)])] が一般に成立。

**検証可能な予測**: 結合律の誤差上界：
```
|R[min(R[min(f,g)], h)] - R[min(f, R[min(g,h)])]| 
  ≤ C · sin²(θ_fg/2) · sin²(θ_(fg)h/2) · min(d_fg, d_(fg)h)
```
直交交差で最大、接線交差で消失。

**Houdini検証方法**:
1. VDB SDF Combineで3つのVDBを二通りの順序で結合
2. 各中間段階でVDB Reshapeで再距離化
3. 結果の差分をVDB Combineで取り最大値を測定
4. 交差角を変えてスケーリング確認

### 熱帯幾何学との深い接続

n個のプリミティブのCSG木は熱帯半環上の多項式の評価。smooth min/maxへの置き換えはMaslov脱量子化の逆（量子化）。

**類推**: smooth CSGの零集合は「SDF空間のアメーバ」であり、β → ∞で厳密なCSG零集合（「SDF空間の熱帯多様体」）に退化する。

### 実用的含意

1. **ブレンドパラメータ選択**: δ_max = sin²(θ/2) は β に無依存。滑らかブレンドでは最大欠損は不可避、幅のみ制御可能。
2. **Order 3補正のVEX実装**: 特性曲線積分はray marchingと同等、VDB/Volume VOPで自然に実装可能。
3. **CSG木の最適順序**: 交差角が小さいペアを先に結合すると結合律誤差が最小。

### 既存研究との差分

1. **"Operations on SDF Estimates" (2022)**: set-contact smoothnessでエイコナル違反を定量化。熱帯代数枠組み・Order 3補正・結合律解析なし。
2. **"Higher Order Algebraic SDFs" (2023)**: 代数的SDF再構成に焦点。CSG演算の代数構造は未分析。
3. **"CSG on Neural SDFs" (2023)**: ニューラルSDF特有の問題。古典的SDF代数の理論なし。

### 今後の方向

1. Order 3補正の明示的計算（球・箱など基本形状で閉形式）
2. 結合律誤差の厳密証明（粘性解の比較原理を利用）
3. Houdini実装と実験検証
4. 熱帯多様体としてのCSG木の構造定理

## 自己評価

今日の最大の貢献は、SDF集合演算とMaslov脱量子化/熱帯幾何学の明示的接続。エイコナル欠損 δ_max = sin²(θ/2) がβに依存しないという事実は実務的にも重要：「ブレンドを弱くしても最大誤差は変わらない、幅が変わるだけ」。
